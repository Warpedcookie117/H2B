{% extends "partials/base.html" %}
{% load static %}

{% block content %}

<!-- ðŸ”¥ DEFINIMOS LA UBICACIÃ“N DEL POS (PISO) -->
<script>
    const sucursal_id = {{ ubicacion_pos.id }};
</script>

<div class="flex flex-col lg:flex-row gap-6 p-4 lg:p-6 h-auto lg:h-[calc(100vh-80px)]">

    <!-- IZQUIERDA: CARRITO -->
    <div class="flex flex-col flex-1 bg-white rounded-xl shadow p-4 lg:p-6 min-h-[400px]">

        <h2 class="text-2xl font-bold mb-4">Punto de Venta</h2>

        <!-- â­ ALERTA DE Ã‰XITO / ERROR -->
        <div id="pos-alerta" class="hidden p-3 rounded-lg font-bold text-center mb-3"></div>

        <!-- INPUT ESCANEO -->
        <input 
            id="scan-input"
            type="text"
            placeholder="Escanea cÃ³digo o escribe nombre..."
            class="w-full p-3 border border-gray-300 rounded-lg text-lg mb-4 focus:ring focus:ring-red-300"
            autofocus
        >

        <!-- CARRITO (DROPZONE) -->
        <div id="carrito-lista"
             class="flex-1 overflow-y-auto pr-2 space-y-3 border-2 border-dashed border-gray-300 rounded-lg min-h-[200px]"
             ondragover="event.preventDefault()">
        </div>

        <!-- TOTAL -->
        <div class="mt-4 border-t pt-4">
            <h3 class="text-3xl font-bold mb-4">
                Total: $<span id="total-general">0.00</span>
            </h3>

            <!-- ERROR STOCK -->
            <div id="error-stock" class="hidden text-red-600 font-bold text-sm mb-2"></div>

            <!-- COBRAR -->
            <button id="btn-cobrar"
                class="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-xl font-bold transition">
                COBRAR
            </button>
        </div>

    </div>

    <!-- DERECHA: PRODUCTOS -->
    <div class="w-full lg:w-[520px] bg-white rounded-xl shadow p-4 lg:p-6 flex flex-col">

        <div class="flex justify-between items-center mb-3">
            <h3 class="text-xl font-bold">Productos</h3>

            <!-- BOTÃ“N 10% -->
            <button id="btn-descuento"
                class="px-2 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded-md transition 
                    shrink-0 w-20 text-center whitespace-nowrap select-none">
                10% OFF
            </button>
        </div>

        <!-- BUSCADOR -->
        <input 
            id="buscar-producto"
            type="text"
            placeholder="Buscar producto..."
            class="p-3 border border-gray-300 rounded-lg mb-4 focus:ring focus:ring-red-300"
        >

        <!-- GRID DE PRODUCTOS -->
        <div id="lista-productos" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-2 gap-4 overflow-y-auto pr-2">

            {% for p in productos %}
            <div 
                class="producto-item bg-gray-100 hover:bg-gray-200 rounded-lg cursor-pointer shadow-sm transition 
                       flex flex-col p-3 gap-2"
                data-id="{{ p.id }}"
                data-nombre="{{ p.nombre }}"
                data-codigo="{{ p.codigo_barras }}"
                data-sku="{{ p.id }}"
                data-men="{{ p.precio_menudeo }}"
                data-may="{{ p.precio_mayoreo }}"
                data-doc="{{ p.precio_docena }}"
                data-stock-piso="{{ p.stock_piso }}"
                data-stock-bodega="{{ p.stock_bodega }}"
                draggable="true"
            >
                <!-- IMAGEN -->
                <div class="w-full h-32 bg-gray-200 rounded-md overflow-hidden flex items-center justify-center">
                    {% if p.foto_url %}
                        <img src="{{ p.foto_url.url }}" class="w-full h-full object-cover">
                    {% else %}
                        <img src="{% static 'img/no-image.png' %}" class="w-full h-full object-contain">
                    {% endif %}
                </div>

                <!-- INFO -->
                <div class="flex flex-col">
                    <p class="font-semibold text-base leading-normal truncate">{{ p.nombre }}</p>
                    <p class="text-red-600 font-bold text-lg">${{ p.precio_menudeo }}</p>
                </div>
            </div>
            {% endfor %}

        </div>

    </div>

</div>

<!-- MODAL -->
<div id="modal-pago" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-[350px] animate-scaleIn">

        <h2 class="text-xl font-bold mb-4 text-center">Pago</h2>

        <div class="mb-4 flex justify-between">
            <label class="font-semibold">Efectivo:</label>
            <input id="pago-efectivo" type="number" step="0.01" min="0"
                class="border p-2 rounded w-32">
        </div>

        <div class="mb-6 flex justify-between">
            <label class="font-semibold">Tarjeta:</label>
            <input id="pago-tarjeta" type="number" step="0.01" min="0"
                class="border p-2 rounded w-32">
        </div>

        <div class="flex justify-between">
            <button id="confirmar-pago"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold">
                Confirmar
            </button>

            <button id="cerrar-modal"
                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-bold">
                Cancelar
            </button>
        </div>

    </div>
</div>

<!-- MAIN JS COMO MÃ“DULO -->
<script type="module" src="{% static 'js/pos/pos.js' %}"></script>

{% endblock %}