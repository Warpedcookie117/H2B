{% extends 'partials/base.html' %}
{% load static %}

{% block content %}

<div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 border-b pb-2 gap-3">
  <h2 class="text-3xl font-bold text-gray-800">Mis Productos</h2>

  <!-- üî• Barra buscadora -->
  <input type="text" id="buscadorProductos"
        placeholder="Buscar producto..."
        class="px-3 py-2 border rounded-lg shadow-sm focus:ring focus:ring-blue-300 w-full md:w-64">
</div>

<!-- üî• KANBAN RESPONSIVE -->
<div class="grid gap-6 pb-6 w-full 
            grid-cols-1 
            sm:grid-cols-2 
            lg:grid-cols-3 
            xl:grid-cols-4">

{% for u in ubicaciones %}
<div class="dropzone bg-gray-50 rounded-lg shadow-md p-4 w-full">
  
  <h3 class="text-xl font-semibold text-gray-700 mb-4">
    üì¶ {{ u.nombre }}
  </h3>

  <div class="space-y-4">

    {% for producto in productos %}
      {% for inv in producto.inventarios.all %}
        {% if inv.ubicacion.id == u.id %}

        <div class="bg-white rounded-lg shadow p-4 producto-card transition-all duration-300"
             data-nombre="{{ producto.nombre|lower }}"
             data-descripcion="{{ producto.descripcion|lower }}">

          <h4 class="text-lg font-bold text-gray-800">{{ producto.nombre }}</h4>
          <p class="text-sm text-gray-600">{{ producto.descripcion }}</p>

          <ul class="mt-3 text-sm text-gray-700 space-y-1">
            <li>‚Ä¢ Menudeo: ${{ producto.precio_menudeo }}</li>
            <li>‚Ä¢ Mayoreo: ${{ producto.precio_mayoreo }}</li>
            <li>‚Ä¢ Docena: ${{ producto.precio_docena }}</li>
            <li>‚Ä¢ Cantidad: {{ inv.cantidad_actual }}</li>
          </ul>

          <!-- üî• Bot√≥n ver en ubicaci√≥n -->
          <div class="flex gap-2 mt-3">
            <a href="{% url 'inventario:productos_por_ubicacion' inv.ubicacion.id %}?highlight={{ producto.id }}"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white py-1.5 rounded text-sm font-semibold flex items-center justify-center gap-1">
              üìç Ver en ubicaci√≥n
            </a>
          </div>

          <!-- üî• Bot√≥n ver detalle (pink) -->
          <div class="flex gap-2 mt-2">
            <a href="{% url 'inventario:detalle_producto' inv.producto.id %}"
              class="w-full bg-pink-500 hover:bg-pink-600 text-white py-1.5 rounded text-sm font-semibold flex items-center justify-center gap-1">
              <i class="fas fa-info-circle"></i> Ver detalle
            </a>
          </div>

        </div>

        {% endif %}
      {% endfor %}
    {% empty %}
      <p class="text-gray-500 italic">No hay productos en {{ u.nombre }}.</p>
    {% endfor %}

  </div>
</div>
{% endfor %}

</div>

{% endblock %}

{% block scripts %}
<script>
// üî• Buscador con animaci√≥n (igual que Inventario Global)
document.getElementById("buscadorProductos").addEventListener("input", function () {
    const query = this.value.toLowerCase();
    const cards = document.querySelectorAll(".producto-card");

    cards.forEach(card => {
        const nombre = card.dataset.nombre;
        const descripcion = card.dataset.descripcion;

        if (nombre.includes(query) || descripcion.includes(query)) {
            card.classList.remove("opacity-0", "scale-95");
            card.classList.add("opacity-100", "scale-100");
            card.style.display = "block";
        } else {
            card.classList.add("opacity-0", "scale-95");
            setTimeout(() => {
                if (!nombre.includes(query) && !descripcion.includes(query)) {
                    card.style.display = "none";
                }
            }, 200);
        }
    });
});
</script>
{% endblock %}