{% extends 'partials/base.html' %}
{% load static %}

{% block content %}

<style>
  /* Estilo local para checkboxes de temporada */
  .temporada-checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: .5rem;
  }

  .temporada-checkbox-group > * {
    display: flex !important;
    align-items: center;
    gap: .5rem;
    padding: .4rem .6rem;
    border: 1px solid #fca5a5;
    border-radius: .5rem;
    background: #fff;
    cursor: pointer;
    transition: border-color .2s ease, background .2s ease;
  }

  .temporada-checkbox-group > *:hover {
    border-color: #ef4444;
    background: #fff5f5;
  }

  .temporada-checkbox-group input[type="checkbox"] {
    width: 1rem;
    height: 1rem;
    accent-color: #dc2626;
  }
</style>

<h2 class="text-3xl font-bold mb-8 text-center text-red-600">Registrar nuevo producto</h2>

{% if form.errors %}
<div class="bg-red-100 text-red-700 p-3 rounded mb-6">
  <strong>Errores en el formulario:</strong>
  <ul class="mt-1">
    {% for field, errors in form.errors.items %}
      <li><strong>{{ field }}:</strong> {{ errors|join:", " }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<form id="form-producto" method="post" enctype="multipart/form-data"
      class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-6">
  {% csrf_token %}


  <!-- Nombre -->
  <div>
    <label class="block font-semibold mb-1">{{ form.nombre.label }}</label>
    {{ form.nombre }}
  </div>

  <!-- Descripción -->
  <div>
    <label class="block font-semibold mb-1">{{ form.descripcion.label }}</label>
    {{ form.descripcion }}
  </div>

  <!-- Código de barras -->
  <div>
    <label class="block font-semibold mb-1">{{ form.codigo_barras.label }}</label>
    {{ form.codigo_barras }}
  </div>

  <!-- Precios -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <div>
      <label class="block font-semibold mb-1">{{ form.precio_menudeo.label }}</label>
      {{ form.precio_menudeo }}
    </div>

    <div>
      <label class="block font-semibold mb-1">{{ form.precio_mayoreo.label }}</label>
      {{ form.precio_mayoreo }}
    </div>

    <div>
      <label class="block font-semibold mb-1">{{ form.precio_docena.label }}</label>
      {{ form.precio_docena }}
    </div>

  </div>

  <!-- Foto -->
  <div>
    <label class="block font-semibold mb-1">{{ form.foto_url.label }}</label>
    {{ form.foto_url }}

    <div id="preview-foto" class="mt-3"></div>
  </div>

  <!-- Temporada -->
  <div>
    <label class="block font-semibold mb-1">{{ form.temporada.label }}</label>

    <div class="temporada-checkbox-group">
      {{ form.temporada }}
    </div>

    {% if form.temporada.errors %}
      <p class="text-red-600 text-sm mt-1">{{ form.temporada.errors }}</p>
    {% endif %}
  </div>

  <!-- Ubicación -->
  <div>
    <label class="block font-semibold mb-1">{{ form.ubicacion.label }}</label>
    {{ form.ubicacion }}
  </div>

  <!-- Dueño -->
  <div>
    <label class="block font-semibold mb-1">{{ form.dueño.label }}</label>
    {{ form.dueño }}
  </div>

  <!-- Categoría padre -->
  <div>
    <label class="block font-semibold mb-1">{{ form.categoria_padre.label }}</label>
    {{ form.categoria_padre }}
  </div>

  <!-- Subcategoría -->
  <div>
    <label class="block font-semibold mb-1">{{ form.subcategoria.label }}</label>
    {{ form.subcategoria }}
  </div>

  <!-- Cantidad inicial -->
  <div>
    <label class="block font-semibold mb-1">{{ form.cantidad_inicial.label }}</label>
    {{ form.cantidad_inicial }}
    {% if form.cantidad_inicial.help_text %}
      <small class="text-gray-600">{{ form.cantidad_inicial.help_text }}</small>
    {% endif %}
  </div>

  {{ form.tipo_codigo }}

  <!-- Atributos dinámicos -->
  <div id="atributos-container"></div>

  <!-- Datos de atributos -->
  <div id="atributos-data" style="display: none;">
    {% for atributo in atributos %}
      <div data-categoria="{{ atributo.categoria.id }}"
           data-id="{{ atributo.id }}"
           data-nombre="{{ atributo.nombre }}"></div>
    {% endfor %}
  </div>

  <!-- Datos de subcategorías -->
  <div id="subcategorias-data" style="display: none;">
    {% for sub in subcategorias %}
      <div data-id="{{ sub.id }}"
           data-nombre="{{ sub.nombre }}"
           data-padre="{{ sub.padre.id }}"></div>
    {% endfor %}
  </div>


  <!-- Botón -->
  <button id="submit-btn" type="submit"
          class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition">
    Registrar producto
  </button>

</form>

{% block scripts %}
<script type="module" src="{% static 'js/nuevo_producto/nuevo_producto.js' %}"></script>
{% endblock %}

{% endblock %}