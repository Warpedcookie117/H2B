{% extends 'partials/base.html' %}
{% load static %}

{% block content %}

<div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

    <!-- TÃTULO -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-10">
        <h1 class="text-3xl font-extrabold text-gray-800">ğŸ—‚ï¸ CategorÃ­as y SubcategorÃ­as</h1>

        {% if not solo_lectura %}
        <button onclick="abrirModalCategoria()"
                class="mt-4 sm:mt-0 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition">
            â• Registrar categorÃ­a padre
        </button>
        {% endif %}
    </div>

    <!-- MENSAJES -->
    <div id="msgSuccess" class="hidden bg-green-600 text-white px-4 py-2 rounded mb-4"></div>
    <div id="msgError" class="hidden bg-red-600 text-white px-4 py-2 rounded mb-4"></div>

    <!-- GRID DE CATEGORÃAS PADRE -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

        {% for padre in categorias_padre %}
        <div class="bg-white border rounded-xl shadow p-6 hover:shadow-lg transition">

            <!-- HEADER DE CATEGORÃA PADRE -->
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-red-600">{{ padre.nombre }}</h2>

                {% if not solo_lectura %}
                <button onclick="abrirModalCategoria({{ padre.id }})"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded text-xs font-semibold">
                    âœï¸ Editar
                </button>
                {% endif %}
            </div>

            <!-- DESCRIPCIÃ“N -->
            {% if padre.descripcion %}
            <p class="text-sm text-gray-700 mb-4 whitespace-pre-line">
                {{ padre.descripcion }}
            </p>
            {% else %}
            <p class="text-xs text-gray-500 italic mb-4">Sin descripciÃ³n.</p>
            {% endif %}

            <!-- SUBCATEGORÃAS -->
            <h3 class="text-sm font-semibold text-gray-800 mb-2">SubcategorÃ­as</h3>

            {% if padre.subcategorias.all %}
            <ul class="space-y-3">

                {% for sub in padre.subcategorias.all %}
                <li class="p-3 bg-gray-50 border rounded-lg shadow-sm">

                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-gray-800">{{ sub.nombre }}</span>

                        {% if not solo_lectura %}
                        <div class="flex gap-2">

                            <button onclick="abrirModalSubcategoria({{ padre.id }}, {{ sub.id }})"
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs">
                                âœï¸
                            </button>

                            <button onclick="confirmarEliminarSub({{ padre.id }}, {{ sub.id }})"
                                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs">
                                ğŸ—‘ï¸
                            </button>

                        </div>
                        {% endif %}
                    </div>

                    {% if sub.descripcion %}
                    <p class="text-xs text-gray-600 mt-1">{{ sub.descripcion }}</p>
                    {% endif %}

                </li>
                {% endfor %}

            </ul>
            {% else %}
            <p class="text-xs text-gray-500 italic">No hay subcategorÃ­as registradas.</p>
            {% endif %}

            <!-- BOTÃ“N AGREGAR SUBCATEGORÃA -->
            {% if not solo_lectura %}
            <button onclick="abrirModalSubcategoria({{ padre.id }})"
                    class="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm mt-4 font-semibold transition">
                â• Agregar subcategorÃ­a
            </button>
            {% endif %}

        </div>
        {% endfor %}

    </div>

</div>

<!-- ============================= -->
<!-- MODAL CATEGORÃA PADRE -->
<!-- ============================= -->
<div id="modalCategoria"
     class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div id="modalCategoriaContent"
         class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
    </div>
</div>

<!-- ============================= -->
<!-- MODAL SUBCATEGORÃA -->
<!-- ============================= -->
<div id="modalSubcategoria"
     class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div id="modalSubcategoriaContent"
         class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
    </div>
</div>

<!-- ============================= -->
<!-- MODAL CONFIRMAR ELIMINACIÃ“N -->
<!-- ============================= -->
<div id="modalConfirmar"
     class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm p-6">

        <h2 class="text-xl font-semibold mb-4 text-gray-800">Confirmar eliminaciÃ³n</h2>
        <p class="text-gray-700 mb-6">Â¿Seguro que deseas eliminar esta subcategorÃ­a?</p>

        <div class="flex justify-end gap-3">
            <button class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded transition"
                    onclick="cerrarConfirmar()">
                Cancelar
            </button>

            <button id="btnConfirmarEliminar"
                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition">
                Eliminar
            </button>
        </div>

    </div>
</div>

<script src="{% static 'js/categorias.js' %}"></script>

{% endblock %}