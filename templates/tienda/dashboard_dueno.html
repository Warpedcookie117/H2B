{% extends 'partials/base.html' %}

{% block title %}Panel del Dueño - Comercializadora Modelo{% endblock %}

{% block content %}
<section class="py-16">
  <div class="max-w-6xl mx-auto px-6">

    <!-- Encabezado -->
    <header class="mb-12 text-center">
      <h2 class="text-4xl md:text-5xl font-extrabold text-red-600 tracking-tight">
        Panel del Dueño
      </h2>
      <p class="mt-3 text-gray-600">Control total de inventario y operaciones</p>
    </header>

    <!-- KPIs principales -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-14">

      <!-- Inventario total -->
      <div class="relative bg-white/60 backdrop-blur-sm border rounded-2xl p-6 shadow-md hover:shadow-xl transition">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-xl flex items-center justify-center bg-gradient-to-br from-green-400 to-green-600 text-white">
            <i class="fas fa-box-open text-2xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-800">Inventario total</h3>
            <p class="mt-1 text-3xl font-extrabold text-gray-900">{{ total_productos }}</p>
            <span class="text-sm text-gray-500">Productos registrados</span>
          </div>
        </div>
      </div>

      <!-- Ventas totales -->
      <div class="relative bg-white/60 backdrop-blur-sm border rounded-2xl p-6 shadow-md hover:shadow-xl transition">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-xl flex items-center justify-center bg-gradient-to-br from-blue-400 to-blue-600 text-white">
            <i class="fas fa-dollar-sign text-2xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-800">Ventas totales</h3>
            <p class="mt-1 text-3xl font-extrabold text-gray-900">${{ ventas_totales|default:0 }} MXN</p>
            <span class="text-sm text-gray-500">Histórico acumulado</span>
          </div>
        </div>
      </div>

      <!-- Ubicaciones activas -->
      <div class="relative bg-white/60 backdrop-blur-sm border rounded-2xl p-6 shadow-md hover:shadow-xl transition">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-xl flex items-center justify-center bg-gradient-to-br from-purple-400 to-pink-500 text-white">
            <i class="fas fa-map-marker-alt text-2xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-800">Ubicaciones activas</h3>
            <p class="mt-1 text-3xl font-extrabold text-gray-900">{{ ubicaciones_sidebar|length }}</p>
            <span class="text-sm text-gray-500">Sucursales / almacenes</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Acciones rápidas -->
    <h3 class="text-2xl md:text-3xl font-bold text-red-600 mb-6">Acciones rápidas</h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">

      <!-- Registrar nuevo producto -->
      <a href="{% url 'inventario:nuevo_producto' %}"
         class="group block rounded-2xl bg-white/60 backdrop-blur-sm p-6 shadow-sm hover:shadow-lg transition">
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-lg flex items-center justify-center bg-green-100 text-green-600 group-hover:bg-green-200">
            <i class="fas fa-plus text-lg"></i>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-gray-800">Registrar producto</h4>
            <p class="mt-1 text-sm text-gray-500">Agregar un nuevo artículo al inventario</p>
          </div>
        </div>
      </a>

      <!-- Inventario global -->
      <a href="{% url 'inventario:lista_productos' %}"
         class="group block rounded-2xl bg-white/60 backdrop-blur-sm p-6 shadow-sm hover:shadow-lg transition">
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-lg flex items-center justify-center bg-blue-100 text-blue-600 group-hover:bg-blue-200">
            <i class="fas fa-warehouse text-lg"></i>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-gray-800">Inventario global</h4>
            <p class="mt-1 text-sm text-gray-500">Consulta todos los productos</p>
          </div>
        </div>
      </a>

      <!-- Agregar ubicación -->
      <a href="{% url 'inventario:ubicaciones' %}"
         class="group block rounded-2xl bg-white/60 backdrop-blur-sm p-6 shadow-sm hover:shadow-lg transition">
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-lg flex items-center justify-center bg-red-100 text-red-600 group-hover:bg-red-200">
            <i class="fas fa-map-marker-alt text-lg"></i>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-gray-800">Agregar ubicación</h4>
            <p class="mt-1 text-sm text-gray-500">Crear o Eliminar una nueva sucursal o almacén</p>
          </div>
        </div>
      </a>

    </div>

    <!-- Charts -->
    <div class="mt-16 grid grid-cols-1 md:grid-cols-2 gap-10">

      <!-- Productos más vendidos -->
      <div class="bg-white/60 backdrop-blur-sm p-6 rounded-2xl shadow">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Productos más vendidos</h3>
        <canvas id="chartMasVendidos"></canvas>
      </div>

      <!-- Ventas totales por mes -->
      <div class="bg-white/60 backdrop-blur-sm p-6 rounded-2xl shadow">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Ventas totales por mes</h3>
        <canvas id="chartVentasMes"></canvas>
      </div>

    </div>

  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Datos dummy por ahora (cuando hagas la app de ventas, los llenamos)
  const masVendidos = {{ mas_vendidos|default:"[]"|safe }};
  const ventasMes = {{ ventas_mes_data|default:"[]"|safe }};

  new Chart(document.getElementById("chartMasVendidos"), {
    type: "bar",
    data: {
      labels: masVendidos.map(x => x.nombre),
      datasets: [{
        label: "Ventas",
        data: masVendidos.map(x => x.cantidad),
        backgroundColor: "#ef4444"
      }]
    }
  });

  new Chart(document.getElementById("chartVentasMes"), {
    type: "line",
    data: {
      labels: ventasMes.map(x => x.mes),
      datasets: [{
        label: "Ventas",
        data: ventasMes.map(x => x.total),
        borderColor: "#3b82f6",
        fill: false
      }]
    }
  });
</script>

{% endblock %}